# TroubleShooting

## Could not identify an equality operator for type point

### Problem

This error occurs when querying from the `events` table because the query generated by Ent includes a `distinct` clause that applies to all columns. By default, PostgreSQL does not have a way to compare some types like `point` and throws an error.

### Solution

Taken from [StackOverflow](https://stackoverflow.com/questions/43998658/errorcould-not-identify-an-equality-operator-for-type-point/44005459#44005459)

To check for equality in a `UNION` or `EXCEPT` clause, PostgreSQL uses the equality operator of the type's default operator class for the `btree` or the `hash` access method (See the documentation for an explanation of these terms).

The problem is that there is no such operator class for the type `point`.

You can create one yourself. You have to use the `hash` access method because points cannot be ordered in a reasonable fashion.

Apart from an equality operator, a `hash` operator class also needs a hash function for the data type, but it is easy to write one for `point`:

```postgresql
CREATE OR REPLACE FUNCTION public.hashpoint(point) RETURNS integer
LANGUAGE sql IMMUTABLE
AS 'SELECT hashfloat8($1[0]) # hashfloat8($1[1])';
```

Now you can define an operator class (you have to be superuser, because such a badly defined operator class can confuse or crash the server):

```postgresql
CREATE OPERATOR CLASS public.point_hash_ops DEFAULT FOR TYPE point USING hash AS
OPERATOR 1 ~=(point,point),
FUNCTION 1 public.hashpoint(point);
```

Now it should work:

```postgresql
VALUES (POINT '(1,1)'), (POINT '(2, 2)')
EXCEPT
VALUES (POINT '(1,1)');

┌─────────┐
│ column1 │
├─────────┤
│ (2,2)   │
└─────────┘
(1 row)
```
